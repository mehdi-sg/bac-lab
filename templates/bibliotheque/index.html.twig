{% extends 'base.html.twig' %}

{% block title %}Biblioth√®que de Ressources{% endblock %}

{% block css %}
    {{ parent() }}
    <style>
        .bibliotheque-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 60px 0 80px;
            margin-top: 80px;
            color: white;
        }
        .search-filters-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 30px;
            margin-top: -50px;
            position: relative;
            z-index: 10;
        }
        .search-input {
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            padding: 14px 20px 14px 45px;
            font-size: 15px;
            transition: all 0.3s;
        }
        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        .filter-select {
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            transition: all 0.3s;
        }
        .filter-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .tag-badge {
            display: inline-block;
            padding: 6px 16px;
            background: #f0f0ff;
            color: #667eea;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            margin: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tag-badge:hover {
            background: #667eea;
            color: white;
        }
        .resource-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            transition: all 0.3s;
            overflow: hidden;
            height: 100%;
        }
        .resource-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        .resource-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 16px;
        }
        .resource-icon.pdf { background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); }
        .resource-icon.video { background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); }
        .resource-icon.exercices { background: linear-gradient(135deg, #55efc4 0%, #00b894 100%); }
        .resource-icon.lien { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); }
        .resource-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .resource-type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 12px;
        }
        .resource-type-badge.exercices { background: #d4f4dd; color: #00b894; }
        .resource-type-badge.video { background: #e8e4ff; color: #6c5ce7; }
        .resource-type-badge.pdf { background: #fff3cd; color: #e17055; }
        .resource-stats {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            color: #636e72;
            margin-bottom: 8px;
        }
        .resource-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 16px;
        }
        .resource-tag {
            padding: 3px 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 11px;
            color: #636e72;
        }
        .download-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            color: white;
        }
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0 20px;
        }
        .sort-select {
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 13px;
        }
    </style>
{% endblock %}

{% block body %}
<div class="bibliotheque-header">
    <div class="container text-center">
        <h1 class="display-5 fw-bold mb-2">Biblioth√®que de Ressources</h1>
        <p class="lead mb-0">Trouvez cours, exercices, vid√©os et annales pour votre pr√©paration</p>
    </div>
</div>

<div class="container">
    <div class="search-filters-card">
        <form method="get">
            <div class="row g-3 mb-3">
                <div class="col-12">
                    <div class="position-relative">
                        <svg class="search-icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" name="q" value="{{ q }}" class="form-control search-input" placeholder="Rechercher des ressources...">
                    </div>
                </div>
            </div>
            
            <div class="row g-3 mb-3">
                <div class="col-md-3">
                    <label class="form-label small fw-semibold text-muted">Fili√®re</label>
                    <select class="form-select filter-select" name="filiere" onchange="this.form.submit()">
                        <option value="">Toutes les fili√®res</option>
                        <option value="math" {{ filiere == 'math' ? 'selected' : '' }}>Math√©matiques</option>
                        <option value="svt" {{ filiere == 'svt' ? 'selected' : '' }}>Sciences de la Vie et de la Terre</option>
                        <option value="info" {{ filiere == 'info' ? 'selected' : '' }}>Informatique</option>
                        <option value="technique" {{ filiere == 'technique' ? 'selected' : '' }}>Technique</option>
                        <option value="lettre" {{ filiere == 'lettre' ? 'selected' : '' }}>Lettres</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small fw-semibold text-muted">Mati√®re</label>
                    <select class="form-select filter-select" name="matiere" onchange="this.form.submit()">
                        <option value="">Toutes les mati√®res</option>
                        <option value="math" {{ matiere == 'math' ? 'selected' : '' }}>Math√©matiques</option>
                        <option value="physique" {{ matiere == 'physique' ? 'selected' : '' }}>Physique</option>
                        <option value="chimie" {{ matiere == 'chimie' ? 'selected' : '' }}>Chimie</option>
                        <option value="svt" {{ matiere == 'svt' ? 'selected' : '' }}>SVT</option>
                        <option value="info" {{ matiere == 'info' ? 'selected' : '' }}>Informatique</option>
                        <option value="francais" {{ matiere == 'francais' ? 'selected' : '' }}>Fran√ßais</option>
                        <option value="anglais" {{ matiere == 'anglais' ? 'selected' : '' }}>Anglais</option>
                        <option value="arabe" {{ matiere == 'arabe' ? 'selected' : '' }}>Arabe</option>
                        <option value="philo" {{ matiere == 'philo' ? 'selected' : '' }}>Philosophie</option>
                        <option value="histoire" {{ matiere == 'histoire' ? 'selected' : '' }}>Histoire-G√©ographie</option>
                        <option value="economie" {{ matiere == 'economie' ? 'selected' : '' }}>√âconomie</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small fw-semibold text-muted">Type</label>
                    <select name="typeFichier" class="form-select filter-select" onchange="this.form.submit()">
                        <option value="">Tous les types</option>
                        <option value="PDF" {{ typeFichier == 'PDF' ? 'selected' : '' }}>üìÑ PDF</option>
                        <option value="VIDEO" {{ typeFichier == 'VIDEO' ? 'selected' : '' }}>üé¨ Vid√©o</option>
                        <option value="LIEN" {{ typeFichier == 'LIEN' ? 'selected' : '' }}>üîó Lien</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small fw-semibold text-muted">Cat√©gorie</label>
                    <select name="categorie" class="form-select filter-select" onchange="this.form.submit()">
                        <option value="">Toutes les cat√©gories</option>
                        <option value="Cours" {{ categorie == 'Cours' ? 'selected' : '' }}>Cours</option>
                        <option value="Exercices" {{ categorie == 'Exercices' ? 'selected' : '' }}>Exercices</option>
                        <option value="Corrig√©" {{ categorie == 'Corrig√©' ? 'selected' : '' }}>Corrig√©</option>
                        <option value="R√©sum√©" {{ categorie == 'R√©sum√©' ? 'selected' : '' }}>R√©sum√©</option>
                        <option value="Bac blanc" {{ categorie == 'Bac blanc' ? 'selected' : '' }}>Bac blanc</option>
                    </select>
                </div>
            </div>

            <div class="d-flex align-items-center gap-2">
                <span class="small fw-semibold text-muted">Tags populaires:</span>
                <span class="tag-badge">BAC 2024</span>
                <span class="tag-badge">R√©sum√©</span>
                <span class="tag-badge">Corrig√©</span>
                <span class="tag-badge">Nouveau</span>
            </div>
        </form>
    </div>

    <div class="results-header">
        <div>
            <strong>{{ ressources|length }}</strong> ressources trouv√©es
        </div>
        <select class="sort-select">
            <option>Plus r√©cent</option>
            <option>Plus t√©l√©charg√©</option>
            <option>Mieux not√©</option>
        </select>
    </div>

    {% if ressources is empty %}
        <div class="alert alert-info text-center">Aucune ressource trouv√©e.</div>
    {% else %}
        <div class="row g-4 mb-5">
            {% for r in ressources %}
                <div class="col-md-4">
                    <div class="resource-card">
                        <div class="p-4">
                            <div class="resource-icon {{ r.typeFichier|lower }}">
                                {% if r.typeFichier == 'PDF' %}
                                    üìÑ
                                {% elseif r.typeFichier == 'VIDEO' %}
                                    üé¨
                                {% elseif r.typeFichier == 'LIEN' %}
                                    üîó
                                {% else %}
                                    üìù
                                {% endif %}
                            </div>
                            
                            <h3 class="resource-title">{{ r.titre }}</h3>
                            
                            <span class="resource-type-badge {{ r.typeFichier|lower }}">
                                {{ r.typeFichier }}
                            </span>
                            
                            <div class="resource-stats">
                                <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                <span class="ms-1">{{ (r.noteMoyenne ?: 4.5)|number_format(1) }}</span>
                                <span class="ms-3">{{ r.nombreTelechargements }} t√©l√©chargements</span>
                            </div>
                            
                            {% if r.tags %}
                                <div class="resource-tags">
                                    {% for tag in r.tags|split(',') %}
                                        <span class="resource-tag">{{ tag|trim }}</span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            
                            <a href="{{ path('app_bibliotheque_show', {id: r.id}) }}" class="download-btn text-decoration-none">
                                üëÅÔ∏è Voir
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}
