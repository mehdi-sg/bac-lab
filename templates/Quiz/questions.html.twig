{% extends 'back_base.html.twig' %}

{% block title %}Questions - {{ quiz.titre }} - Admin{% endblock %}

{% block page_title %}Questions du Quiz{% endblock %}
{% block page_subtitle %}{{ quiz.titre }}{% endblock %}

{% block stylesheets %}
<style>
    /* ── Flash ──────────────────────────────────── */
    .flash-success {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 14px 18px;
        border-radius: var(--radius);
        border: 1px solid rgba(53,255,182,0.25);
        background: rgba(53,255,182,0.08);
        color: #35FFB6;
        font-weight: 700;
        font-size: 14px;
        margin-bottom: 20px;
    }

    /* ── Quiz info banner ───────────────────────── */
    .quiz-banner {
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.05);
        backdrop-filter: blur(14px);
        box-shadow: var(--glow);
        padding: 26px 28px;
        margin-bottom: 22px;
        position: relative;
        overflow: hidden;
    }

    .quiz-banner::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0;
        height: 3px;
        background: var(--grad1);
    }

    .quiz-banner-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: wrap;
    }

    .quiz-banner-left {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .quiz-banner-icon {
        width: 52px; height: 52px;
        border-radius: 16px;
        background: var(--grad1);
        display: flex; align-items: center; justify-content: center;
        font-size: 22px;
        flex-shrink: 0;
    }

    .quiz-banner-title {
        font-size: 20px;
        font-weight: 900;
        margin: 0 0 4px;
        line-height: 1.2;
    }

    .quiz-banner-desc {
        color: var(--muted);
        font-size: 13px;
        font-weight: 600;
        margin: 0;
    }

    /* ── Actions bar ────────────────────────────── */
    .actions-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 22px;
        flex-wrap: wrap;
    }

    .btn-back {
        display: inline-flex; align-items: center; gap: 8px;
        padding: 10px 18px; border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.05);
        color: var(--muted);
        font-size: 13px; font-weight: 800;
        text-decoration: none;
        transition: background 0.2s, color 0.2s, border-color 0.2s;
    }
    .btn-back:hover {
        background: rgba(255,255,255,0.09);
        border-color: rgba(255,255,255,0.18);
        color: var(--text);
    }

    .btn-add-question {
        display: inline-flex; align-items: center; gap: 8px;
        padding: 11px 22px; border-radius: 14px;
        border: 1px solid rgba(53,255,182,0.35);
        background: var(--grad3);
        color: #fff;
        font-weight: 800; font-size: 14px;
        text-decoration: none;
        transition: opacity 0.2s, transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 6px 24px rgba(53,255,182,0.20);
    }
    .btn-add-question:hover {
        opacity: .88;
        transform: translateY(-2px);
        box-shadow: 0 10px 32px rgba(53,255,182,0.30);
        color: #fff;
    }

    /* ── Question card ──────────────────────────── */
    .question-card {
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.05);
        backdrop-filter: blur(14px);
        box-shadow: 0 14px 40px rgba(0,0,0,0.18);
        padding: 26px;
        margin-bottom: 16px;
        transition: transform 0.22s, box-shadow 0.22s, border-color 0.22s;
        position: relative;
        overflow: hidden;
    }

    .question-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0;
        height: 3px;
        background: var(--grad1);
        opacity: 0;
        transition: opacity 0.22s;
    }

    .question-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 22px 56px rgba(0,0,0,0.24);
        border-color: rgba(255,255,255,0.16);
    }

    .question-card:hover::before { opacity: 1; }

    /* ── Question header ────────────────────────── */
    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 16px;
    }

    .question-header-left {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }

    .question-number {
        display: inline-flex; align-items: center; gap: 6px;
        padding: 5px 14px; border-radius: 20px;
        background: var(--grad1);
        font-size: 12px; font-weight: 900;
        color: #fff;
    }

    .question-type {
        display: inline-flex; align-items: center; gap: 5px;
        padding: 5px 14px; border-radius: 20px;
        border: 1px solid rgba(46,211,255,0.30);
        background: rgba(46,211,255,0.10);
        color: #2ED3FF;
        font-size: 11px; font-weight: 800;
    }

    /* ── Question actions ───────────────────────── */
    .question-actions {
        display: flex; gap: 8px; flex-shrink: 0;
    }

    .btn-sm {
        display: inline-flex; align-items: center; gap: 6px;
        padding: 7px 14px; border-radius: 10px;
        font-size: 12px; font-weight: 800;
        text-decoration: none;
        border: 1px solid transparent;
        cursor: pointer; background: none;
        transition: opacity 0.18s, transform 0.18s;
        white-space: nowrap; font-family: inherit;
    }
    .btn-sm:hover { opacity: .78; transform: translateY(-1px); }

    .btn-edit-q  { background: rgba(53,255,182,0.12); border-color: rgba(53,255,182,0.28); color: #35FFB6; }
    .btn-delete-q{ background: rgba(255,77,141,0.12); border-color: rgba(255,77,141,0.28); color: #FF4D8D; }

    /* ── Question text ──────────────────────────── */
    .question-text {
        font-size: 16px;
        font-weight: 700;
        line-height: 1.65;
        margin-bottom: 20px;
        padding: 16px 18px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(0,0,0,0.15);
    }

    /* ── Choices ────────────────────────────────── */
    .choices-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 20px;
    }

    .choice-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.03);
        font-size: 14px;
        font-weight: 600;
        transition: border-color 0.2s;
    }

    .choice-item.correct {
        border-color: rgba(53,255,182,0.40);
        background: rgba(53,255,182,0.07);
    }

    .choice-letter {
        width: 30px; height: 30px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.06);
        display: inline-flex; align-items: center; justify-content: center;
        font-size: 12px; font-weight: 900;
        flex-shrink: 0;
        color: var(--muted);
    }

    .choice-item.correct .choice-letter {
        background: var(--grad3);
        border-color: transparent;
        color: #fff;
    }

    .choice-check {
        margin-left: auto;
        color: #35FFB6;
        font-size: 13px;
    }

    /* ── Question meta ──────────────────────────── */
    .question-meta {
        display: flex;
        gap: 18px;
        flex-wrap: wrap;
        padding-top: 16px;
        border-top: 1px solid var(--border);
        font-size: 12px;
        font-weight: 700;
        color: var(--muted);
    }

    .meta-item {
        display: inline-flex; align-items: center; gap: 6px;
    }

    .meta-item i { opacity: .7; }

    /* ── Empty state ────────────────────────────── */
    .empty-state {
        border-radius: var(--radius);
        border: 1px dashed var(--border);
        background: rgba(255,255,255,0.03);
        text-align: center;
        padding: 70px 30px;
    }

    .empty-icon {
        width: 72px; height: 72px;
        border-radius: 20px;
        background: rgba(255,255,255,0.06);
        border: 1px solid var(--border);
        display: flex; align-items: center; justify-content: center;
        font-size: 28px;
        margin: 0 auto 20px;
        color: var(--muted);
    }

    .empty-state h3 { font-weight: 900; font-size: 20px; margin-bottom: 8px; }
    .empty-state p  { color: var(--muted); font-size: 14px; font-weight: 600; margin-bottom: 24px; }

    @media (max-width: 768px) {
        .question-header  { flex-direction: column; }
        .question-actions { flex-wrap: wrap; }
        .actions-bar      { flex-direction: column; align-items: stretch; }
        .btn-back, .btn-add-question { justify-content: center; }
    }
</style>
{% endblock %}

{% block body %}

    {# ── Flash ────────────────────────────────── #}
    {% for message in app.flashes('success') %}
        <div class="flash-success">
            <i class="fa-solid fa-circle-check"></i> {{ message }}
        </div>
    {% endfor %}

    {# ── Quiz banner ──────────────────────────── #}
    <div class="quiz-banner">
        <div class="quiz-banner-inner">
            <div class="quiz-banner-left">
                <div class="quiz-banner-icon">
                    <i class="fa-solid fa-brain"></i>
                </div>
                <div>
                    <p class="quiz-banner-title">{{ quiz.titre }}</p>
                    <p class="quiz-banner-desc">{{ quiz.description }}</p>
                </div>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
                <span style="display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:20px;border:1px solid var(--border);background:rgba(255,255,255,0.05);font-size:12px;font-weight:800;color:var(--muted);">
                    <i class="fa-solid fa-circle-question"></i> {{ questions|length }} question(s)
                </span>
                <span style="display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:20px;border:1px solid var(--border);background:rgba(255,255,255,0.05);font-size:12px;font-weight:800;color:var(--muted);">
                    <i class="fa-solid fa-clock"></i> {{ quiz.duree }} min
                </span>
            </div>
        </div>
    </div>

    {# ── Actions bar ──────────────────────────── #}
    <div class="actions-bar">
        <a href="{{ path('admin_quiz_index') }}" class="btn-back">
            <i class="fa-solid fa-arrow-left"></i> Retour aux quiz
        </a>
        <a href="{{ path('admin_question_new', {id: quiz.id}) }}" class="btn-add-question">
            <i class="fa-solid fa-plus"></i> Ajouter une Question
        </a>
    </div>

    {# ── Questions list ───────────────────────── #}
    {% if questions|length > 0 %}

        {% set letters = ['A','B','C','D','E','F','G','H','I','J'] %}

        {% for question in questions %}
        <div class="question-card">

            <div class="question-header">
                <div class="question-header-left">
                    <span class="question-number">
                        <i class="fa-solid fa-hashtag"></i> {{ loop.index }}
                    </span>
                    <span class="question-type">
                        <i class="fa-solid fa-{{ question.typeQuestion == 'QCM' ? 'list-check' : 'toggle-on' }}"></i>
                        {{ question.typeQuestion }}
                    </span>
                </div>
                <div class="question-actions">
                    <a href="{{ path('admin_question_edit', {id: question.id}) }}" class="btn-sm btn-edit-q">
                        <i class="fa-solid fa-pen-to-square"></i> Modifier
                    </a>
                    <form method="POST" action="{{ path('admin_question_delete', {id: question.id}) }}" style="display:inline;" onsubmit="return confirm('Supprimer cette question ? Cette action est irréversible.');">
                        <button type="submit" class="btn-sm btn-delete-q">
                            <i class="fa-solid fa-trash-can"></i> Supprimer
                        </button>
                    </form>
                </div>
            </div>

            <div class="question-text">{{ question.enonce }}</div>

            <div class="choices-list">
                {% for choix in question.choix %}
                <div class="choice-item {{ choix.estCorrect ? 'correct' : '' }}">
                    <span class="choice-letter">{{ letters[loop.index0] }}</span>
                    <span>{{ choix.libelle }}</span>
                    {% if choix.estCorrect %}
                        <i class="fa-solid fa-check choice-check"></i>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <div class="question-meta">
                <span class="meta-item">
                    <i class="fa-solid fa-star"></i> {{ question.score }} point(s)
                </span>
                <span class="meta-item">
                    <i class="fa-solid fa-book"></i> {{ quiz.matiere.nom }}
                </span>
                <span class="meta-item">
                    <i class="fa-solid fa-bookmark"></i> {{ quiz.chapitre.titre }}
                </span>
            </div>

        </div>
        {% endfor %}

    {% else %}

        <div class="empty-state">
            <div class="empty-icon">
                <i class="fa-solid fa-circle-question"></i>
            </div>
            <h3>Aucune question pour le moment</h3>
            <p>Ajoutez des questions pour enrichir ce quiz.</p>
            <a href="{{ path('admin_question_new', {id: quiz.id}) }}" class="btn-add-question">
                <i class="fa-solid fa-plus"></i> Ajouter une question
            </a>
        </div>

    {% endif %}

{% endblock %}