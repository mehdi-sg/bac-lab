{% extends 'base.html.twig' %}

{% block css %}
    {{ parent() }}
    {# Load premium fiche CSS - Phase 1 Foundation #}
    <link rel="stylesheet" href="{{ asset('front/css/fiche-premium.css') }}">
    
    {# CRITICAL: Fix dropdown conflicts with very specific selectors #}
    <style>
        /* DROPDOWN FIX - Ultra specific selectors to override all conflicts */
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom {
            position: relative !important;
            min-width: 220px !important;
            z-index: 1001 !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom .fiche-filter-trigger {
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            gap: 8px !important;
            padding: 12px 16px !important;
            background: rgba(30, 41, 59, 0.8) !important;
            border: 1px solid rgba(148, 163, 184, 0.2) !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            backdrop-filter: blur(8px) !important;
            width: 100% !important;
            box-sizing: border-box !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom .fiche-filter-trigger:hover {
            border-color: rgba(0, 212, 255, 0.4) !important;
            background: rgba(51, 65, 85, 0.9) !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom .fiche-filter-dropdown {
            position: absolute !important;
            top: calc(100% + 8px) !important;
            left: 0 !important;
            right: 0 !important;
            width: 100% !important;
            background: rgba(30, 41, 59, 0.95) !important;
            border: 1px solid rgba(0, 212, 255, 0.3) !important;
            border-radius: 8px !important;
            box-shadow: 
                0 20px 40px -12px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(0, 212, 255, 0.1) !important;
            opacity: 0 !important;
            visibility: hidden !important;
            transform: translateY(-10px) !important;
            transition: all 0.3s ease !important;
            z-index: 1002 !important;
            max-height: 300px !important;
            min-height: auto !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            backdrop-filter: blur(12px) !important;
            box-sizing: border-box !important;
            /* CRITICAL: Ensure it's not clipped */
            clip: unset !important;
            clip-path: none !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom.active .fiche-filter-dropdown {
            opacity: 1 !important;
            visibility: visible !important;
            transform: translateY(0) !important;
            display: block !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom .fiche-filter-dropdown .fiche-filter-option {
            display: block !important;
            padding: 12px 16px !important;
            font-size: 14px !important;
            color: rgba(203, 213, 225, 0.8) !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            position: relative !important;
            overflow: visible !important;
            white-space: nowrap !important;
            min-height: 44px !important;
            line-height: 20px !important;
            box-sizing: border-box !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom .fiche-filter-dropdown .fiche-filter-option:last-child {
            border-bottom: none !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom .fiche-filter-dropdown .fiche-filter-option:hover {
            background: rgba(0, 212, 255, 0.15) !important;
            color: rgba(248, 250, 252, 0.95) !important;
            padding-left: 24px !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom .fiche-filter-dropdown .fiche-filter-option.selected {
            color: #00d4ff !important;
            background: rgba(0, 212, 255, 0.15) !important;
            font-weight: 600 !important;
            padding-left: 24px !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-filter-filiere .fiche-filter-custom .fiche-filter-dropdown .fiche-filter-option.selected::before {
            content: 'âœ“' !important;
            position: absolute !important;
            left: 8px !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
            color: #00d4ff !important;
            font-weight: 700 !important;
        }
        
        /* CRITICAL: Override any parent container overflow issues */
        .fiche-page .fiche-filter-section {
            overflow: visible !important;
        }
        
        .fiche-page .fiche-filter-actions {
            overflow: visible !important;
        }
        
        .fiche-page .fiche-filter-filiere {
            overflow: visible !important;
        }
        
        /* Ensure dropdown scrollbar is visible */
        .fiche-page .fiche-filter-dropdown::-webkit-scrollbar {
            width: 6px !important;
        }
        
        .fiche-page .fiche-filter-dropdown::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3) !important;
            border-radius: 3px !important;
        }
        
        .fiche-page .fiche-filter-dropdown::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #00d4ff, #b794f6) !important;
            border-radius: 3px !important;
        }
        
        .fiche-page .fiche-filter-dropdown::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #0ea5e9, #a855f7) !important;
        }
        
        /* FIX SORT DROPDOWN - Same ultra specific approach */
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown {
            position: relative !important;
            z-index: 1001 !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-trigger {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            padding: 12px 16px !important;
            background: rgba(30, 41, 59, 0.8) !important;
            border: 1px solid rgba(148, 163, 184, 0.2) !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            font-size: 14px !important;
            color: rgba(203, 213, 225, 0.8) !important;
            backdrop-filter: blur(8px) !important;
            box-sizing: border-box !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-trigger:hover {
            background: rgba(51, 65, 85, 0.9) !important;
            border-color: rgba(0, 212, 255, 0.4) !important;
            color: rgba(248, 250, 252, 0.95) !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-trigger i {
            font-size: 12px !important;
            transition: transform 0.2s ease !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown.active .fiche-sort-trigger i {
            transform: rotate(180deg) !important;
            color: #00d4ff !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-menu {
            position: absolute !important;
            top: calc(100% + 8px) !important;
            right: 0 !important;
            min-width: 180px !important;
            background: rgba(30, 41, 59, 0.95) !important;
            border: 1px solid rgba(0, 212, 255, 0.3) !important;
            border-radius: 8px !important;
            box-shadow: 
                0 20px 40px -12px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(0, 212, 255, 0.1) !important;
            opacity: 0 !important;
            visibility: hidden !important;
            transform: translateY(-10px) !important;
            transition: all 0.3s ease !important;
            z-index: 1002 !important;
            backdrop-filter: blur(12px) !important;
            box-sizing: border-box !important;
            /* CRITICAL: Ensure it's not clipped */
            clip: unset !important;
            clip-path: none !important;
            overflow: visible !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown.active .fiche-sort-menu {
            opacity: 1 !important;
            visibility: visible !important;
            transform: translateY(0) !important;
            display: block !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-menu .fiche-sort-option {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            padding: 12px 16px !important;
            font-size: 14px !important;
            color: rgba(203, 213, 225, 0.8) !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            border-left: 2px solid transparent !important;
            box-sizing: border-box !important;
            white-space: nowrap !important;
            min-height: 44px !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-menu .fiche-sort-option:last-child {
            border-bottom: none !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-menu .fiche-sort-option:hover {
            background: rgba(0, 212, 255, 0.15) !important;
            color: rgba(248, 250, 252, 0.95) !important;
            border-left-color: #00d4ff !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-menu .fiche-sort-option.active {
            color: #00d4ff !important;
            background: rgba(0, 212, 255, 0.15) !important;
            border-left-color: #00d4ff !important;
            font-weight: 600 !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-menu .fiche-sort-option i {
            font-size: 12px !important;
            opacity: 0.7 !important;
        }
        
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-menu .fiche-sort-option:hover i,
        .fiche-page .fiche-filter-section .fiche-filter-actions .fiche-sort-dropdown .fiche-sort-menu .fiche-sort-option.active i {
            opacity: 1 !important;
        }
        
        /* FICHE CARD ICONS - CREATIVE CENTERED DESIGN */
        .fiche-page .fiche-card-icon-header {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            padding: 24px 20px 16px 20px !important;
            position: relative !important;
            background: linear-gradient(135deg, 
                rgba(0, 212, 255, 0.05) 0%, 
                rgba(183, 148, 246, 0.05) 50%, 
                rgba(0, 212, 255, 0.05) 100%) !important;
            border-radius: 12px 12px 0 0 !important;
            margin: -1px -1px 0 -1px !important;
            border: 1px solid rgba(0, 212, 255, 0.1) !important;
            border-bottom: none !important;
        }
        
        .fiche-page .fiche-card-icon-header::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2300d4ff' fill-opacity='0.03'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") !important;
            pointer-events: none !important;
            border-radius: 12px 12px 0 0 !important;
        }
        
        .fiche-page .fiche-card-icon-large {
            width: 64px !important;
            height: 64px !important;
            border-radius: 16px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            position: relative !important;
            background: linear-gradient(135deg, 
                rgba(0, 212, 255, 0.15) 0%, 
                rgba(183, 148, 246, 0.15) 50%, 
                rgba(0, 212, 255, 0.15) 100%) !important;
            border: 2px solid rgba(0, 212, 255, 0.3) !important;
            overflow: hidden !important;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
            box-shadow: 
                0 8px 32px rgba(0, 212, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(12px) !important;
        }
        
        .fiche-page .fiche-card-icon-large::before {
            content: '' !important;
            position: absolute !important;
            inset: 0 !important;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                transparent 50%, 
                rgba(0, 212, 255, 0.1) 100%) !important;
            border-radius: 14px !important;
            opacity: 0 !important;
            transition: opacity 0.3s ease !important;
        }
        
        .fiche-page .fiche-card:hover .fiche-card-icon-large {
            transform: translateY(-4px) scale(1.05) !important;
            box-shadow: 
                0 16px 48px rgba(0, 212, 255, 0.3),
                0 0 0 1px rgba(0, 212, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
            border-color: rgba(0, 212, 255, 0.5) !important;
        }
        
        .fiche-page .fiche-card:hover .fiche-card-icon-large::before {
            opacity: 1 !important;
        }
        
        .fiche-page .fiche-card-icon-default-large {
            background: linear-gradient(135deg, 
                rgba(148, 163, 184, 0.15) 0%, 
                rgba(100, 116, 139, 0.15) 50%, 
                rgba(148, 163, 184, 0.15) 100%) !important;
            border-color: rgba(148, 163, 184, 0.3) !important;
            color: rgba(148, 163, 184, 0.8) !important;
            box-shadow: 
                0 8px 32px rgba(148, 163, 184, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        }
        
        .fiche-page .fiche-card:hover .fiche-card-icon-default-large {
            border-color: rgba(148, 163, 184, 0.5) !important;
            color: rgba(148, 163, 184, 1) !important;
            box-shadow: 
                0 16px 48px rgba(148, 163, 184, 0.2),
                0 0 0 1px rgba(148, 163, 184, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
        }
        
        .fiche-page .fiche-icon-img-large {
            width: 48px !important;
            height: 48px !important;
            object-fit: cover !important;
            border-radius: 12px !important;
            transition: all 0.3s ease !important;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.2)) !important;
        }
        
        .fiche-page .fiche-card:hover .fiche-icon-img-large {
            filter: drop-shadow(0 4px 16px rgba(0, 0, 0, 0.3)) brightness(1.1) !important;
        }
        
        .fiche-page .fiche-card-icon-default-large i {
            font-size: 28px !important;
            transition: all 0.3s ease !important;
        }
        
        .fiche-page .fiche-card:hover .fiche-card-icon-default-large i {
            transform: scale(1.1) !important;
        }
        
        .fiche-page .fiche-icon-glow {
            position: absolute !important;
            inset: -2px !important;
            background: linear-gradient(135deg, 
                rgba(0, 212, 255, 0.4) 0%, 
                rgba(183, 148, 246, 0.4) 50%, 
                rgba(0, 212, 255, 0.4) 100%) !important;
            border-radius: 18px !important;
            opacity: 0 !important;
            transition: opacity 0.4s ease !important;
            z-index: -1 !important;
            filter: blur(8px) !important;
        }
        
        .fiche-page .fiche-card:hover .fiche-icon-glow {
            opacity: 0.6 !important;
            animation: icon-pulse 2s ease-in-out infinite !important;
        }
        
        @keyframes icon-pulse {
            0%, 100% { 
                opacity: 0.6 !important; 
                transform: scale(1) !important; 
            }
            50% { 
                opacity: 0.8 !important; 
                transform: scale(1.05) !important; 
            }
        }
        
        /* Update card header to work with centered icon */
        .fiche-page .fiche-card-header {
            padding: 16px 20px 8px 20px !important;
            text-align: center !important;
            border: none !important;
            background: none !important;
        }
        
        .fiche-page .fiche-card-title {
            margin: 0 0 12px 0 !important;
            text-align: center !important;
            font-size: 18px !important;
            font-weight: 600 !important;
            line-height: 1.3 !important;
            color: var(--fiche-text-primary) !important;
        }
        
        .fiche-page .fiche-card-badges {
            display: flex !important;
            justify-content: center !important;
            flex-wrap: wrap !important;
            gap: 6px !important;
            margin-bottom: 8px !important;
        }
        
        /* Adjust card body for centered layout */
        .fiche-page .fiche-card-body {
            padding: 8px 20px 16px 20px !important;
            text-align: center !important;
        }
        
        .fiche-page .fiche-card-excerpt {
            text-align: left !important;
            margin-bottom: 16px !important;
        }
        
        .fiche-page .fiche-card-tags {
            justify-content: center !important;
            margin-bottom: 16px !important;
        }
        
        .fiche-page .fiche-card-meta {
            justify-content: center !important;
            text-align: center !important;
        }
        
        /* Enhanced card hover effect */
        .fiche-page .fiche-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }
        
        .fiche-page .fiche-card:hover {
            transform: translateY(-8px) !important;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(0, 212, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        }
        
        /* Remove old icon styles */
        .fiche-page .fiche-card-icon-title {
            display: none !important;
        }
        
        .fiche-page .fiche-card-icon {
            display: none !important;
        }
        
        /* ICON SELECTOR IN FORMS */
        .fiche-icon-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
            background-position: right 8px center !important;
            background-repeat: no-repeat !important;
            background-size: 16px 12px !important;
            padding-right: 40px !important;
        }
        
        .fiche-icon-preview {
            display: inline-flex !important;
            align-items: center !important;
            gap: 8px !important;
            margin-top: 8px !important;
            padding: 8px 12px !important;
            background: rgba(0, 212, 255, 0.1) !important;
            border: 1px solid rgba(0, 212, 255, 0.2) !important;
            border-radius: 6px !important;
            font-size: 14px !important;
            color: var(--fiche-text-secondary) !important;
        }
        
        .fiche-icon-preview img {
            width: 24px !important;
            height: 24px !important;
            border-radius: 4px !important;
        }
        
        /* FICHE SHOW PAGE ICON */
        .fiche-show-icon-img {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            border-radius: 8px !important;
        }
    </style>
{% endblock %}

{% block body_class %}fiche-page{% endblock %}

{% block body %}
<div class="fiche-page">
    {% block fiche_content %}{% endblock %}
</div>
{% endblock %}
