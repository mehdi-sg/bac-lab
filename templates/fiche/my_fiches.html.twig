{% extends 'fiche/_layout.html.twig' %}

{% block title %}Mes fiches - BAC Lab{% endblock %}

{% block css %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('front/css/fiche.css') }}">
{% endblock %}

{% block body_class %}fiche-my-fiches-page{% endblock %}

{% block fiche_title %}{% endblock %}

{% block fiche_subtitle %}{% endblock %}

{% block fiche_header_actions %}{% endblock %}

{% block fiche_content %}
<!-- Floating Background Shapes -->
<div class="fiche-shapes">
    <div class="fiche-shape fiche-shape-1" style="background: #11998e;"></div>
    <div class="fiche-shape fiche-shape-2" style="background: #38ef7d;"></div>
    <div class="fiche-shape fiche-shape-3" style="background: #00c6ff;"></div>
</div>

<!-- Hero Section -->
<div class="fiche-hero">
    <h1 class="fiche-hero-title" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); -webkit-background-clip: text;">
        <i class="fa fa-bookmark mr-3"></i>
        Mes fiches
    </h1>
    <p class="fiche-hero-subtitle">
        Gérez vos fiches de révision dont vous êtes modérateur
    </p>
</div>

<!-- Create Button -->
<div class="text-center mb-5">
    <a href="{{ path('fiche_new') }}" class="fiche-btn fiche-btn-primary btn-lg px-5 py-3" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); box-shadow: 0 4px 20px rgba(17, 153, 142, 0.4);">
        <i class="fa fa-plus-circle mr-2"></i>
        Créer une nouvelle fiche
    </a>
</div>

{% if fiches is empty %}
    <!-- Empty State -->
    <div class="fiche-empty">
        <div class="fiche-empty-icon" style="background: linear-gradient(135deg, rgba(17, 153, 142, 0.1), rgba(56, 239, 125, 0.1));">
            <i class="fa fa-folder-open" style="color: #11998e;"></i>
        </div>
        <h2 class="fiche-empty-title">Aucune fiche</h2>
        <p class="fiche-empty-text">
            Vous n'êtes modérateur d'aucune fiche pour le moment.
        </p>
        <a href="{{ path('fiche_new') }}" class="fiche-btn fiche-btn-primary btn-lg px-5" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
            <i class="fa fa-plus mr-2"></i>
            Créer votre première fiche
        </a>
    </div>
{% else %}
    <!-- Cards Grid -->
    <div class="fiche-grid">
        {% for fiche in fiches %}
            <div class="fiche-ultimate-card">
                <!-- Card Header -->
                <div class="fiche-card-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    <div class="fiche-card-icon" style="background: rgba(255,255,255,0.2);">
                        <i class="fa fa-file-text-o"></i>
                    </div>
                    <h3 class="fiche-card-title">{{ fiche.title }}</h3>
                    <span class="fiche-card-badge" style="background: rgba(255,255,255,0.25);">
                        <i class="fa fa-star mr-1"></i>
                        Propriétaire
                    </span>
                </div>
                
                <!-- Card Body -->
                <div class="fiche-card-body">
                    <p class="fiche-card-excerpt">
                        {{ fiche.content|slice(0, 180) }}{% if fiche.content|length > 180 %}...{% endif %}
                    </p>
                    
                    <!-- Meta -->
                    <div class="fiche-card-meta">
                        <div class="fiche-card-date">
                            <i class="fa fa-calendar-alt"></i>
                            {{ fiche.createdAt|date('d/m/Y') }}
                        </div>
                        <div class="fiche-card-stats">
                            <span class="fiche-card-stat">
                                <i class="fa fa-align-left"></i>
                                {{ fiche.content|length }} car.
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Card Actions -->
                <div class="fiche-card-actions">
                    <a href="{{ path('fiche_show', {'id': fiche.id}) }}" class="fiche-btn fiche-btn-primary" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);">
                        <i class="fa fa-eye"></i>
                        Voir
                    </a>
                    <a href="{{ path('fiche_edit', {'id': fiche.id}) }}" class="fiche-btn fiche-btn-secondary">
                        <i class="fa fa-edit"></i>
                    </a>
                    <button type="button" class="fiche-btn fiche-btn-danger" data-toggle="modal" data-target="#deleteModal{{ fiche.id }}">
                        <i class="fa fa-trash"></i>
                    </button>
                </div>
            </div>

            <!-- Delete Modal -->
            <div class="fiche-modal-overlay" id="deleteModal{{ fiche.id }}" tabindex="-1" role="dialog">
                <div class="fiche-modal">
                    <div class="fiche-modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                        <h5 class="mb-0">
                            <i class="fa fa-exclamation-triangle mr-2"></i>
                            Confirmer la suppression
                        </h5>
                    </div>
                    <div class="fiche-modal-body">
                        <i class="fa fa-trash fa-4x text-danger opacity-50 mb-3 d-block"></i>
                        <p class="mb-1">Êtes-vous sûr de vouloir supprimer cette fiche ?</p>
                        <h6 class="text-success" style="color: #11998e !important;">{{ fiche.title }}</h6>
                        <p class="text-danger mt-3 mb-0">
                            <small><i class="fa fa-exclamation-circle mr-1"></i>Cette action est irréversible.</small>
                        </p>
                    </div>
                    <div class="fiche-modal-footer">
                        <button type="button" class="fiche-btn fiche-btn-secondary" data-dismiss="modal">
                            <i class="fa fa-times mr-1"></i>Annuler
                        </button>
                        <form action="{{ path('fiche_delete', {'id': fiche.id}) }}" method="post" class="d-inline">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete_fiche_' ~ fiche.id) }}">
                            <button type="submit" class="fiche-btn fiche-btn-danger">
                                <i class="fa fa-trash mr-1"></i>Supprimer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Modal handling
    const modals = document.querySelectorAll('.fiche-modal-overlay');
    modals.forEach(modal => {
        const closeBtn = modal.querySelector('[data-dismiss="modal"]');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });
        }
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });
    });
    
    // Open modal on button click
    const deleteButtons = document.querySelectorAll('[data-target^="#deleteModal"]');
    deleteButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const target = btn.getAttribute('data-target');
            document.querySelector(target).classList.add('active');
        });
    });
});
</script>

<style>
.fiche-my-fiches-page .fiche-page{
    background: linear-gradient(135deg, #0f0c29 0%, #11998e 50%, #24243e 100%);
}
</style>

{% endblock %}
